/**
 * @file index.js
 * @description –ì–ª–∞–≤–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (Application Root Entry Point).
 * –≠—Ç–æ—Ç —Ñ–∞–π–ª –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞:
 * 1. –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –æ–∫—Ä—É–∂–µ–Ω–∏—è (Environment Check).
 * 2. –ì–ª–æ–±–∞–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ (Global Error Handling).
 * 3. –ó–∞–ø—É—Å–∫ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (Bootstrapping).
 *
 * @module Index
 * @version 9.1.0 (Enterprise ERP Edition)
 * @author ProElectric Team
 */

import process from "process";

// =============================================================================
// 1. –ì–õ–û–ë–ê–õ–¨–ù–ê–Ø –û–ë–†–ê–ë–û–¢–ö–ê –û–®–ò–ë–û–ö (SAFETY NET)
// =============================================================================
// –≠—Ç–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—Ç –ø–∞–¥–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏–∑-–∑–∞ –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫,
// –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –±—ã–ª–∏ –æ—Ç–ª–æ–≤–ª–µ–Ω—ã –≤–Ω—É—Ç—Ä–∏ try/catch –±–ª–æ–∫–æ–≤.

/**
 * –ü–µ—Ä–µ—Ö–≤–∞—Ç –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π (Uncaught Exception).
 * –≠—Ç–æ –æ—à–∏–±–∫–∏ –≤ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º –∫–æ–¥–µ, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –±—ã–ª–∏ –ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω—ã.
 */
process.on("uncaughtException", (error) => {
  console.error(
    "\nüî• [FATAL SYSTEM ERROR] –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ:",
  );
  console.error(error);
  // –í Enterprise-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –ø—Ä–æ—Ü–µ—Å—Å –Ω–µ –¥–æ–ª–∂–µ–Ω –≤–∏—Å–µ—Ç—å –≤ –∑–æ–º–±–∏-—Å–æ—Å—Ç–æ—è–Ω–∏–∏.
  // –ú—ã –≤—ã–≤–æ–¥–∏–º –æ—à–∏–±–∫—É –≤ –ª–æ–≥ –∏ —É–±–∏–≤–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —á–µ—Ä–µ–∑ PM2/Docker.
  process.exit(1);
});

/**
 * –ü–µ—Ä–µ—Ö–≤–∞—Ç –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –ø—Ä–æ–º–∏—Å–æ–≤ (Unhandled Rejection).
 * –≠—Ç–æ –æ—à–∏–±–∫–∏ –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º –∫–æ–¥–µ (–∑–∞–±—ã—Ç—ã–π .catch).
 */
process.on("unhandledRejection", (reason, promise) => {
  console.error("\n‚ö†Ô∏è [SYSTEM WARNING] –û–±–Ω–∞—Ä—É–∂–µ–Ω –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π Promise:");
  console.error("–ü—Ä–∏—á–∏–Ω–∞:", reason);
  // –ù–µ –∑–∞–≤–µ—Ä—à–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å, –Ω–æ —Å—Ç—Ä–æ–≥–æ –ª–æ–≥–∏—Ä—É–µ–º –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –¥–µ–±–∞–≥–∞
});

// =============================================================================
// 2. –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –°–ò–°–¢–ï–ú–ï (BANNER)
// =============================================================================

const printSystemBanner = () => {
  // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Å–æ–ª—å –¥–ª—è —á–∏—Å—Ç–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞ –≤ dev-—Ä–µ–∂–∏–º–µ
  if (process.env.NODE_ENV !== "production") {
    console.clear();
  }

  const currentDate = new Date().toLocaleString("ru-RU");
  const nodeVersion = process.version;
  const env = process.env.NODE_ENV || "development";

  console.log("\n==================================================");
  console.log("‚ö°Ô∏è  P R O E L E C T R I C   E R P   v9.1.0  ‚ö°Ô∏è");
  console.log("==================================================");
  console.log(`üåç –û–∫—Ä—É–∂–µ–Ω–∏–µ (Environment):  ${env.toUpperCase()}`);
  console.log(`üì¶ –í–µ—Ä—Å–∏—è Node.js:           ${nodeVersion}`);
  console.log(`üìÖ –í—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞:            ${currentDate}`);
  console.log("--------------------------------------------------");

  // Debug –±–ª–æ–∫ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
  const token = process.env.BOT_TOKEN || process.env.TELEGRAM_BOT_TOKEN;
  console.log("--- SECRETS DEBUG ---");
  console.log("Telegram Token length:", token ? token.length : "‚ùå MISSING");
  console.log(
    "Database URL:",
    process.env.DATABASE_URL ? "‚úÖ CONFIGURED" : "‚ùå MISSING",
  );
  console.log("--------------------------------------------------");
};

// =============================================================================
// 3. –ó–ê–ü–£–°–ö –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø (BOOTSTRAP)
// =============================================================================

/**
 * –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (Bootstrapper).
 * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ —Ñ–∞–∑—ã –∑–∞–≥—Ä—É–∑–∫–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
 * –æ—Ç —Ñ–∞–∑—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç—è–∂–µ–ª—ã—Ö –º–æ–¥—É–ª–µ–π —Å–µ—Ä–≤–µ—Ä–∞.
 */
async function bootstrapApplication() {
  try {
    printSystemBanner();

    console.log("‚è≥ [SYSTEM] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —è–¥—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (v9.1.0)...");

    // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç src/server.js.
    // –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ process.on –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —É–∂–µ –≤–∏—Å—è—Ç –¥–æ —Å—Ç–∞—Ä—Ç–∞ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏.
    await import("./src/server.js");

    // –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –ú—ã –Ω–µ –ø–∏—à–µ–º "–ó–∞–ø—É—â–µ–Ω–æ" –∑–¥–µ—Å—å, —Ç–∞–∫ –∫–∞–∫ server.js —Å–∞–º —Å–æ–æ–±—â–∏—Ç,
    // –∫–æ–≥–¥–∞ –ë–î –ø–æ–¥–∫–ª—é—á–∏—Ç—Å—è –∏ Express/Telegraf —Å—Ç–∞—Ä—Ç—É—é—Ç.
  } catch (error) {
    console.error(
      "\nüí• [BOOTSTRAP ERROR] –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ–π –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ Enterprise-—è–¥—Ä–∞:",
    );
    console.error(error);
    process.exit(1);
  }
}

// –ó–∞–ø—É—Å–∫
bootstrapApplication();
