# 1. Используем стабильный Node.js 20
FROM node:20-slim

# 2. Указываем рабочую директорию
WORKDIR /app

# 3. Копируем ТОЛЬКО package.json (игнорируем старый lock-файл, чтобы npm пересобрал его сам)
COPY package.json ./

# 4. Устанавливаем зависимости. 
# Убираем --omit=dev на этапе сборки, если вдруг какие-то билдеры нужны, 
# либо оставляем для экономии места.
RUN npm install --production

# 5. Копируем всё остальное
COPY . .

# 6. Порт для админки и хелсчека
EXPOSE 3000

# 7. Безопасность: работаем не под рутом
USER node

# 8. Старт системы
CMD ["node", "index.js"]