# 1. Используем легкий официальный образ Node.js (Debian Slim)
FROM node:20-slim

# 2. Указываем рабочую директорию
WORKDIR /app

# 3. Сначала копируем только манифесты (для кэширования npm install)
COPY package*.json ./

# 4. Устанавливаем только продакшн-зависимости (чистая установка)
RUN npm ci --omit=dev

# 5. Копируем исходный код проекта
COPY . .

# 6. Открываем порт для Healthcheck сервера
EXPOSE 3000

# 7. БЕЗОПАСНОСТЬ: Переключаемся на обычного пользователя (не root)
USER node

# 8. Команда запуска
CMD ["node", "index.js"]